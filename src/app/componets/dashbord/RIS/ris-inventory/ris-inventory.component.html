<div class="dashboard-container">
  <!-- Main Content Area -->
    <!-- Dashboard Content (always show) -->
    <div>
    <!-- Filter Containers -->
    <div class="filters-container">
      <!-- Main Filters Container (80% width) -->
      <div class="main-filters-container">
        <div class="filter-row-main">
          <div class="filter-group">
            <label>Project Name:</label>
            <select [value]="filters.projectName" (change)="onProjectChange($event)" class="filter-select">
              <option *ngFor="let project of availableProjects" [value]="project">{{ project }}</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>Date:</label>
            <select [value]="filters.date" (change)="onDateChange($event)" class="filter-select">
              <option *ngFor="let date of availableDates" [value]="date">{{ date }}</option>
            </select>
          </div>
          
          <div class="filter-group">
            <label>Direction:</label>
            <select [value]="filters.direction" (change)="onDirectionChange($event)" class="filter-select">
              <option *ngFor="let direction of availableDirections" [value]="direction">{{ direction }}</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Pavement Type:</label>
            <select [value]="filters.pavementType" (change)="onPavementTypeChange($event)" class="filter-select">
              <option *ngFor="let pavementType of availablePavementTypes" [value]="pavementType">{{ pavementType }}</option>
            </select>
          </div>

          <div class="filter-group">
            <label>Lane:</label>
            <select [value]="filters.lane" (change)="onLaneChange($event)" class="filter-select">
              <option *ngFor="let lane of availableLanes" [value]="lane">{{ lane }}</option>
            </select>
          </div>
          
          <div class="filter-group chainage-range-group">
            <!-- <label class="chainage-range-label">Chainage Range: {{ filters.chainageRange.min.toFixed(3) }} - {{ filters.chainageRange.max.toFixed(3) }} KM</label> -->
            <div class="chainage-inputs">
              <input 
                type="number" 
                [min]="getChainageMin()" 
                [max]="filters.chainageRange.max" 
                [value]="filters.chainageRange.min"
                (input)="onChainageMinChange($event)"
                class="chainage-input"
                step="0.001"
                placeholder="Min"
              >
              <span class="chainage-separator">to</span>
              <input 
                type="number" 
                [min]="filters.chainageRange.min" 
                [max]="getChainageMax()" 
                [value]="filters.chainageRange.max"
                (input)="onChainageMaxChange($event)"
                class="chainage-input"
                step="0.001"
                placeholder="Max"
              >
            </div>
            <div class="chainage-slider-container">
              <input 
                type="range" 
                [min]="getChainageMin()" 
                [max]="getChainageMax()" 
                [value]="filters.chainageRange.min"
                (input)="onChainageMinSliderChange($event)"
                class="chainage-slider min-slider"
                step="0.001"
              >
              <input 
                type="range" 
                [min]="getChainageMin()" 
                [max]="getChainageMax()" 
                [value]="filters.chainageRange.max"
                (input)="onChainageMaxSliderChange($event)"
                class="chainage-slider max-slider"
                step="0.001"
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Data Summary Info -->
    <!-- <div class="data-summary-info">
      <div class="summary-item">
        <span class="summary-label">Total Records:</span>
        <span class="summary-value">{{ rawData.length }}</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Projects:</span>
        <span class="summary-value">{{ availableProjects.length }}</span>
      </div>
      <div class="summary-item">
        <span class="summary-label">Chainage Range:</span>
        <span class="summary-value">{{ filters.chainageRange.min.toFixed(3) }} - {{ filters.chainageRange.max.toFixed(3) }} KM</span>
      </div>
    </div> -->

    <!-- Main Dashboard Content -->
    <div class="dashboard-content">
      <!-- Main Dashboard Container -->
      <div class="main-dashboard-container">
        <!-- Left Side - Charts and Map (70% width) -->
        <div class="left-panel">
        <!-- Chainage Chart -->
        <!-- <div class="chart-container">
          <div class="chart-header">
            <h3>Chainage Wise Assets Distribution</h3>
            <div class="chart-info">
              <span class="chart-data-points">{{ chainageData.length }} chainage points</span>
            </div>
          </div>
          <div class="chart-wrapper">
            <div *ngIf="isBrowser && chainageData.length > 0" echarts [options]="chartOptions" class="echarts-chart"></div>
            <div *ngIf="!isBrowser || chainageData.length === 0" class="chart-placeholder">
              <p *ngIf="!isBrowser">Chart loading...</p>
              <p *ngIf="isBrowser && chainageData.length === 0">No chainage data available</p>
            </div>
          </div>
        </div> -->

        <!-- Map -->
        <div class="map-container">
          <div class="chart-header">
            <h3>Location wise Asset Distribution</h3>
            <div class="chart-buttons">
              <button 
                class="comparison-chart-btn"
                (click)="openChainageComparisonModal()"
                title="View Chainage Comparison Chart"
              >
                <i class="fas fa-chart-line"></i>
                Chainage Comparison
              </button>
            </div>
          </div>
          <div class="map-wrapper">
            <div *ngIf="!filters.date" class="map-placeholder">
              <p>Select a date to view map data</p>
            </div>
            <div *ngIf="filters.date && rawData.length === 0" class="map-placeholder">
              <div class="loading-spinner"></div>
              <p>Loading map data...</p>
            </div>
            <div *ngIf="filters.date" #mapContainer class="map"></div>
          </div>
        </div>
      </div>

      <!-- Right Side - Asset Summary (30% width) -->
      <div class="right-panel">
        <div class="asset-summary">
          <div class="asset-summary-header">
            <h3>Asset Summary</h3>
            <div class="header-buttons">
              <button 
                class="month-comparison-toggle"
                [class.active]="isMonthComparisonMode"
                [class.loading]="isPreloadingMonthData"
                (click)="toggleMonthComparisonMode()"
                title="{{ isMonthComparisonMode ? 'Click to disable month comparison mode' : 'Click to enable month comparison mode' }}"
              >
                <i *ngIf="!isPreloadingMonthData" class="fas fa-calendar-alt"></i>
                <i *ngIf="isPreloadingMonthData" class="fas fa-spinner fa-spin"></i>
                <span class="toggle-label">{{ isMonthComparisonMode ? 'ON' : 'OFF' }}</span>
              </button>
              <button 
                class="pothole-detection-btn"
                (click)="openPotholeDetection()"
                title="View Pothole Detection Analysis"
              >
                <i class="fas fa-road"></i>
                <span>Potholes</span>
              </button>
            </div>
          </div>
          <div class="asset-grid">
            <div *ngIf="!filters.date" class="asset-placeholder">
              <p>Select a date to view asset data</p>
            </div>
            <div *ngIf="filters.date && rawData.length === 0" class="asset-placeholder">
              <div class="loading-spinner"></div>
              <p>Loading asset data...</p>
            </div>
            <div 
              *ngFor="let asset of assetSummary" 
              class="asset-card"
              [class.selected]="selectedAssetType === asset.name"
              [style.border-left-color]="asset.color"
              (click)="onAssetCardClick(asset.name)"
            >
              <!-- <div class="asset-icon" [style.background-color]="asset.color">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
              </div> -->
              <div class="asset-info">
                <div class="asset-name">{{ asset.name }}</div>
                <div class="asset-count">
                  {{ formatAssetCount(asset) }}
                  <span *ngIf="asset.unit" class="asset-unit">{{ asset.unit }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
    
    <!-- Date-wise Comparison Chart (Full Width) -->
    <!-- <div *ngIf="filters.projectName" class="date-comparison-container">
      <div class="date-comparison-chart">
       
        <div *ngIf="isLoadingComparisonChart" class="chart-placeholder">
          <div class="loading-spinner"></div>
          <p>Loading date comparison chart...</p>
        </div>
        
        
        <div *ngIf="!isLoadingComparisonChart && dateComparisonData.length > 0 && isBrowser" 
             echarts 
             [options]="dateComparisonChartOptions" 
             class="echarts-chart date-chart"></div>
        
       
        <div *ngIf="!isLoadingComparisonChart && dateComparisonData.length === 0" class="chart-placeholder">
          <p>No data available for comparison</p>
        </div>
        
       
        <div *ngIf="!isBrowser && !isLoadingComparisonChart" class="chart-placeholder">
          <p>Loading chart...</p>
        </div>
      </div>
    </div> -->

    <!-- Sub-Asset Modal -->
    <div *ngIf="isSubAssetModalOpen" class="modal-backdrop" (click)="closeSubAssetModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ selectedAssetForSubAssets }} - Sub-Assets</h3>
          <button class="modal-close-btn" (click)="closeSubAssetModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div *ngIf="subAssetsList.length === 0" class="no-sub-assets">
            <p>No sub-assets found for {{ selectedAssetForSubAssets }}</p>
          </div>
          <div *ngIf="subAssetsList.length > 0" class="sub-assets-grid">
            <div *ngFor="let subAsset of subAssetsList" class="sub-asset-card">
              <div class="sub-asset-name">{{ subAsset.name }}</div>
              <div class="sub-asset-count">{{ subAsset.count }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chainage Comparison Chart Modal -->
    <div *ngIf="isChainageComparisonModalOpen" class="modal-backdrop comparison-modal-backdrop" (click)="closeChainageComparisonModal()">
      <div class="modal-content comparison-modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>
            <i class="fas fa-chart-line"></i>
            Asset Distribution Along Chainage
          </h3>
          <button class="modal-close-btn" (click)="closeChainageComparisonModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        </div>
        
        <div class="modal-body comparison-modal-body">
          <!-- Asset Selection Chips -->
          <div class="asset-selection-section">
            <div class="asset-selection-header">
              <h4>Select Assets to Compare (Max 5):</h4>
              <span class="selection-count">{{ selectedAssetsForComparison.length }}/5 Selected</span>
            </div>
            <div class="asset-chips-container">
              <button
                *ngFor="let asset of availableAssetsForComparison"
                class="asset-chip"
                [class.selected]="isAssetSelectedForComparison(asset)"
                [style.border-color]="getAssetColor(asset)"
                [style.background-color]="getAssetChipBackgroundColor(asset)"
                (click)="toggleAssetForComparison(asset)"
              >
                <span class="chip-color-indicator" [style.background-color]="getAssetColor(asset)"></span>
                {{ asset }}
                <i *ngIf="isAssetSelectedForComparison(asset)" class="fas fa-check"></i>
              </button>
            </div>
          </div>

          <!-- Comparison Chart -->
          <div class="comparison-chart-container">
            <div *ngIf="selectedAssetsForComparison.length === 0" class="no-assets-selected">
              <p>Please select at least one asset to view the comparison chart</p>
            </div>
            <div 
              *ngIf="selectedAssetsForComparison.length > 0 && chainageComparisonChartOptions && chainageComparisonChartOptions.series" 
              echarts 
              [options]="chainageComparisonChartOptions" 
              class="comparison-echarts-chart"
              style="width: 100%; height: 500px; background: rgba(0,0,0,0.2);"
            ></div>
            <div *ngIf="selectedAssetsForComparison.length > 0 && (!chainageComparisonChartOptions || !chainageComparisonChartOptions.series)" class="loading-chart">
              <div class="loading-spinner"></div>
              <p>Generating chart...</p>
            </div>
          </div>

          <!-- Chart Legend Info -->
          <!-- <div *ngIf="selectedAssetsForComparison.length > 0" class="chart-info">
            <p>
              <i class="fas fa-info-circle"></i>
              Showing distribution from <strong>{{ filters.chainageRange.min.toFixed(2) }} KM</strong> to 
              <strong>{{ filters.chainageRange.max.toFixed(2) }} KM</strong>
            </p>
          </div> -->
        </div>
      </div>
    </div>

    <!-- Month-wise Comparison Chart Modal -->
    <div *ngIf="isMonthComparisonModalOpen" class="modal-backdrop comparison-modal-backdrop" (click)="closeMonthComparisonModal()">
      <div class="modal-content comparison-modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>
            <i class="fas fa-calendar-alt"></i>
            <span *ngIf="selectedAssetsForMonthComparison.length === 1">{{ selectedAssetsForMonthComparison[0] }} - Month-wise Comparison</span>
            <span *ngIf="selectedAssetsForMonthComparison.length !== 1">Asset Distribution - Month-wise Comparison</span>
          </h3>
          <button class="modal-close-btn" (click)="closeMonthComparisonModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        </div>
        
        <div class="modal-body comparison-modal-body">
          <!-- Asset Selection Chips (only show when showAssetSelectionInModal is true) -->
          <div *ngIf="showAssetSelectionInModal" class="asset-selection-section">
            <div class="asset-selection-header">
              <h4>Select Assets to Compare (Max 5):</h4>
              <span class="selection-count">{{ selectedAssetsForMonthComparison.length }}/5 Selected</span>
            </div>
            <div class="asset-chips-container">
              <button
                *ngFor="let asset of availableAssetsForComparison"
                class="asset-chip"
                [class.selected]="isAssetSelectedForMonthComparison(asset)"
                [style.border-color]="getAssetColor(asset)"
                [style.background-color]="getAssetChipBackgroundColorForMonth(asset)"
                (click)="toggleAssetForMonthComparison(asset)"
              >
                <span class="chip-color-indicator" [style.background-color]="getAssetColor(asset)"></span>
                {{ asset }}
                <i *ngIf="isAssetSelectedForMonthComparison(asset)" class="fas fa-check"></i>
              </button>
            </div>
          </div>

          <!-- Comparison Chart -->
          <div class="comparison-chart-container">
            <div *ngIf="selectedAssetsForMonthComparison.length === 0" class="no-assets-selected">
              <p>Please select at least one asset to view the month-wise comparison chart</p>
            </div>
            <div *ngIf="isLoadingMonthChart" class="loading-chart">
              <div class="loading-spinner"></div>
              <p>Loading month-wise data...</p>
              <p style="font-size: 12px; color: rgba(255, 255, 255, 0.6); margin-top: 10px;">
                Fetching data for {{ availableMonthsForComparison.length }} months...
              </p>
            </div>
            <div 
              *ngIf="!isLoadingMonthChart && selectedAssetsForMonthComparison.length > 0 && monthComparisonChartOptions && monthComparisonChartOptions.series" 
              echarts 
              [options]="monthComparisonChartOptions" 
              class="comparison-echarts-chart"
              style="width: 100%; height: 500px;"
            ></div>
            <div *ngIf="!isLoadingMonthChart && selectedAssetsForMonthComparison.length > 0 && (!monthComparisonChartOptions || !monthComparisonChartOptions.series)" class="loading-chart">
              <div class="loading-spinner"></div>
              <p>Generating chart...</p>
            </div>
          </div>

          <!-- Chart Legend Info -->
          <!-- <div *ngIf="selectedAssetsForMonthComparison.length > 0" class="chart-info">
            <p>
              <i class="fas fa-info-circle"></i>
              Comparing asset counts across <strong>{{ availableMonthsForComparison.length }} months</strong> for project <strong>{{ filters.projectName }}</strong>
            </p>
          </div> -->
        </div>
      </div>
    </div>
  </div>

  <!-- Pothole Detection Modal -->
  <div *ngIf="isPotholeModalOpen" class="modal-overlay" (click)="closePotholeModal()">
    <div class="pothole-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i class="fas fa-road"></i>
          Pothole Detection Analysis
        </h3>
        <button class="modal-close-btn" (click)="closePotholeModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="pothole-modal-body">
        

        <!-- Pothole Summary Stats -->
        <!-- <div class="pothole-stats">
          <div class="stat-card">
            <i class="fas fa-exclamation-triangle"></i>
            <div class="stat-info">
              <span class="stat-value">{{ getSegmentPotholes().length }}</span>
              <span class="stat-label">Potholes in Segment</span>
            </div>
          </div>
          <div class="stat-card">
            <i class="fas fa-ruler-vertical"></i>
            <div class="stat-info">
              <span class="stat-value">{{ getAverageDepth() }} mm</span>
              <span class="stat-label">Avg Depth</span>
            </div>
          </div>
          <div class="stat-card">
            <i class="fas fa-expand"></i>
            <div class="stat-info">
              <span class="stat-value">{{ getAverageArea() }} cm²</span>
              <span class="stat-label">Avg Area</span>
            </div>
          </div>
          <div class="stat-card">
            <i class="fas fa-road"></i>
            <div class="stat-info">
              <span class="stat-value">{{ segmentSize }}m</span>
              <span class="stat-label">Segment Length</span>
            </div>
          </div>
        </div> -->

        <!-- Charts Container -->
        <div class="pothole-charts-container">
          <!-- Depth Chart -->
          <div class="pothole-chart-wrapper">
            <div class="chart-header">
              <h4>
                <i class="fas fa-chart-line"></i>
                Laser Line Profile - Pothole Depth Detection
              </h4>
              <p class="chart-description">
                Each line represents a laser sensor (L1-L29) across road width. Vertical drops indicate potholes - lower gray values mean deeper depressions.
              </p>
            </div>
            <div class="pothole-chart">
              <div
                *ngIf="potholeDepthChartOptions"
                echarts
                [options]="potholeDepthChartOptions"
                [loading]="isLoadingPotholeData"
                class="pothole-echarts-chart"
                [autoResize]="true"
              ></div>
            </div>
          </div>

          <!-- Segment Navigation -->
        <div class="segment-navigation">
          <button 
            class="nav-btn prev-btn" 
            (click)="goToPreviousSegment()"
            [disabled]="!canGoToPreviousSegment()"
            title="Previous 10m segment"
          >
            <i class="fas fa-chevron-left"></i>
            <span>Previous</span>
          </button>
          
          <div class="segment-info">
            <span class="segment-label">Segment {{ currentSegmentIndex + 1 }} of {{ totalSegments }}</span>
            <span class="segment-range">{{ getCurrentSegmentInfo() }}</span>
          </div>
          
          <button 
            class="nav-btn next-btn" 
            (click)="goToNextSegment()"
            [disabled]="!canGoToNextSegment()"
            title="Next 10m segment"
          >
            <span>Next</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>

          <!-- Area Distribution Chart with Polygons -->
          <div class="pothole-chart-wrapper pothole-area-wrapper">
            <div class="chart-header">
              <h4>
                <i class="fas fa-draw-polygon"></i>
                Pothole Area Distribution
              </h4>
              <p class="chart-description">
                Grid showing detected pothole regions with colored boundaries. Large potholes (green fill), small potholes (blue fill). Boundaries: Blue (outer) → Red (middle) → Green (inner).
              </p>
            </div>
            <div class="pothole-chart">
              <div
                echarts
                [options]="potholeAreaChartOptions"
                [loading]="isLoadingPotholeData"
                class="pothole-echarts-chart pothole-area-chart"
              ></div>
            </div>
          </div>
        </div>

        <!-- 3D Road Surface View -->
        <div class="road-3d-view-wrapper">
          <div class="view-toggle-buttons">
            <button 
              class="view-btn" 
              [class.active]="currentView === 'top'"
              (click)="switchView('top')"
            >
              <i class="fas fa-border-all"></i>
              Top View
            </button>
            <button 
              class="view-btn" 
              [class.active]="currentView === 'side'"
              (click)="switchView('side')"
            >
              <i class="fas fa-chart-area"></i>
              Side View
            </button>
            <button 
              class="view-btn" 
              [class.active]="currentView === '3d'"
              (click)="switchView('3d')"
            >
              <i class="fas fa-cube"></i>
              3D View
            </button>
          </div>

          <!-- Top View -->
          <div class="pothole-chart-wrapper" *ngIf="currentView === 'top'">
            <div class="chart-header">
              <h4>
                <i class="fas fa-border-all"></i>
                Road Surface - Top View
              </h4>
              <p class="chart-description">
                Bird's eye view of the road surface. Darker colors indicate deeper potholes.
              </p>
            </div>
            <div class="pothole-chart">
              <div
                *ngIf="potholeTopViewOptions"
                echarts
                [options]="potholeTopViewOptions"
                [loading]="isLoadingPotholeData"
                class="pothole-echarts-chart"
                [autoResize]="true"
              ></div>
            </div>
          </div>

          <!-- Side View -->
          <div class="pothole-chart-wrapper" *ngIf="currentView === 'side'">
            <div class="chart-header">
              <h4>
                <i class="fas fa-chart-area"></i>
                Road Surface - Side View (Cross Section)
              </h4>
              <p class="chart-description">
                Cross-sectional view showing road profile depth along distance. Select a laser line to view.
              </p>
              <div class="laser-selector">
                <label>Select Laser Line: </label>
                <select [(ngModel)]="selectedLaserForSideView" (change)="generateSideView()">
                  <option *ngFor="let laser of availableLasersForSideView" [value]="laser">L{{ laser }}</option>
                </select>
              </div>
            </div>
            <div class="pothole-chart">
              <div
                *ngIf="potholeSideViewOptions"
                echarts
                [options]="potholeSideViewOptions"
                [loading]="isLoadingPotholeData"
                class="pothole-echarts-chart"
                [autoResize]="true"
              ></div>
            </div>
          </div>

          <!-- 3D View -->
          <div class="pothole-chart-wrapper" *ngIf="currentView === '3d'">
            <div class="chart-header">
              <h4>
                <i class="fas fa-cube"></i>
                Road Surface - 3D View
              </h4>
              <p class="chart-description">
                Interactive 3D surface plot. Rotate with mouse, zoom with scroll. Depressions show potholes.
              </p>
            </div>
            <div class="pothole-chart">
              <div
                *ngIf="pothole3DViewOptions"
                echarts
                [options]="pothole3DViewOptions"
                [loading]="isLoadingPotholeData"
                class="pothole-echarts-chart-3d"
                [autoResize]="true"
              ></div>
            </div>
          </div>
        </div>

        <!-- Severity Distribution -->
        <!-- <div class="severity-summary">
          <h4>
            <i class="fas fa-chart-pie"></i>
            Severity Distribution
          </h4>
          <div class="severity-grid">
            <div class="severity-card high">
              <i class="fas fa-circle"></i>
              <span class="severity-label">High</span>
              <span class="severity-count">{{ getSeverityCount('High') }}</span>
            </div>
            <div class="severity-card medium">
              <i class="fas fa-circle"></i>
              <span class="severity-label">Medium</span>
              <span class="severity-count">{{ getSeverityCount('Medium') }}</span>
            </div>
            <div class="severity-card low">
              <i class="fas fa-circle"></i>
              <span class="severity-label">Low</span>
              <span class="severity-count">{{ getSeverityCount('Low') }}</span>
            </div>
          </div>
        </div> -->
      </div>
    </div>
  </div>
</div>
