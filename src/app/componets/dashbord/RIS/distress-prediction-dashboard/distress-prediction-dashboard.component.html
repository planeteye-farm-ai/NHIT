<div class="dashboard-container">
  <!-- Main Content Area -->
    <!-- Dashboard Content (always show) -->
    <div>
    <!-- Filter Containers -->
    <div class="filters-container">
      <!-- Main Filters Container (100% width) -->
      <div class="main-filters-container">
        <div class="filter-row-main">
          <!-- Project Name Filter -->
          <div class="filter-group">
            <label>Project Name:</label>
            <select 
              [value]="filters.projectName" 
              (change)="onProjectChange($event)" 
              class="filter-select">
              <option *ngFor="let project of availableProjects" [value]="project">
                {{ project }}
              </option>
            </select>
          </div>
          
          <!-- Date Filter -->
          <div class="filter-group date-filter">
            <label>Date:</label>
            <select 
              [value]="filters.date" 
              (change)="onDateChange($event)" 
              class="filter-select">
              <option *ngFor="let date of availableDates" [value]="date">
                {{ date }}
              </option>
            </select>
          </div>
          
          <!-- Direction Filter -->
          <div class="filter-group">
            <label>Direction:</label>
            <div class="direction-buttons">
              <button 
                [class.active]="filters.direction === 'Increasing'" 
                (click)="onDirectionChange('Increasing')"
                class="direction-btn">
                Increasing
              </button>
              <button 
                [class.active]="filters.direction === 'Decreasing'" 
                (click)="onDirectionChange('Decreasing')"
                class="direction-btn">
                Decreasing
              </button>
            </div>
          </div>
          
          <!-- Pavement Type Filter -->
          <div class="filter-group">
            <label>Pavement Type:</label>
            <select 
              [value]="filters.pavementType" 
              (change)="onPavementTypeChange($event)" 
              class="filter-select">
              <option value="All">All</option>
              <option *ngFor="let type of availablePavementTypes" [value]="type">
                {{ type }}
              </option>
            </select>
          </div>
          
          <!-- Lane Filter -->
          <div class="filter-group lane-filter">
            <label>Lane:</label>
            <select 
              [value]="filters.lane" 
              (change)="onLaneChange($event)" 
              class="filter-select">
              <option value="All">All</option>
              <option *ngFor="let lane of availableLanes" [value]="lane">
                {{ lane }}
              </option>
            </select>
          </div>
          
          <!-- Chainage Range Filter -->
          <div class="filter-group chainage-range-group">
            <!-- <label class="chainage-range-label">
              Chainage: {{ filters.chainageRange.min.toFixed(3) }} - {{ filters.chainageRange.max.toFixed(3) }}
            </label> -->
            <div class="chainage-inputs">
              <input 
                type="number" 
                [min]="getChainageMin()" 
                [max]="filters.chainageRange.max" 
                [value]="filters.chainageRange.min"
                (input)="onChainageMinChange($event)"
                class="chainage-input"
                placeholder="Min"
                step="0.001">
              <input 
                type="number" 
                [min]="filters.chainageRange.min" 
                [max]="getChainageMax()" 
                [value]="filters.chainageRange.max"
                (input)="onChainageMaxChange($event)"
                class="chainage-input"
                placeholder="Max"
                step="0.001">
            </div>
            <div class="chainage-slider-container">
              <input 
                type="range" 
                [min]="getChainageMin()" 
                [max]="getChainageMax()" 
                [value]="filters.chainageRange.min"
                (input)="onChainageMinSliderChange($event)"
                class="chainage-slider min-slider">
              <input 
                type="range" 
                [min]="getChainageMin()" 
                [max]="getChainageMax()" 
                [value]="filters.chainageRange.max"
                (input)="onChainageMaxSliderChange($event)"
                class="chainage-slider max-slider">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Dashboard Container -->
    <div class="main-dashboard-container">
      <!-- Left Panel (50% width) - Map Only -->
      <div class="left-panel">
        <!-- Predicted Distress Map -->
        <div class="map-container">
          <div class="chart-header">
            <h3>Location wise Predicted Distress Distribution</h3>
            <button 
              class="comparison-chart-btn"
              (click)="openChainageComparisonModal()"
              title="View Chainage Comparison Chart"
            >
              <i class="fas fa-chart-line"></i>
              Chainage Comparison
            </button>
          </div>
          <div class="map-wrapper">
            <div *ngIf="!filters.date" class="map-placeholder">
              <p>Select a date to view map data</p>
            </div>
            <div *ngIf="filters.date && rawData.length === 0" class="map-placeholder">
              <div class="loading-spinner"></div>
              <p>Loading map data...</p>
            </div>
            <div *ngIf="filters.date" id="mapContainer" class="map">
              <!-- Data size indicator -->
              <!-- <div class="data-size-indicator" *ngIf="showDataSizeIndicator">
                <i class="fa fa-info-circle"></i>
                Showing {{ displayedMarkersCount }} of {{ totalDataCount }} markers
                <span *ngIf="isDataLimited" class="limited-text">(Performance optimized)</span>
              </div> -->
            </div>
          </div>
        </div>
      </div>

      <!-- Right Panel (30% width) -->
      <div class="right-panel">
        <div class="asset-summary">
          <div class="asset-summary-header">
            <h3>Predicted Distress Summary</h3>
            <button 
              class="month-comparison-toggle"
              [class.active]="isMonthComparisonMode"
              [class.loading]="isPreloadingMonthData"
              (click)="toggleMonthComparisonMode()"
              title="{{ isMonthComparisonMode ? 'Click to disable month comparison mode' : 'Click to enable month comparison mode' }}"
            >
              <i *ngIf="!isPreloadingMonthData" class="fas fa-calendar-alt"></i>
              <i *ngIf="isPreloadingMonthData" class="fas fa-spinner fa-spin"></i>
              <span class="toggle-label">{{ isMonthComparisonMode ? 'ON' : 'OFF' }}</span>
            </button>
          </div>
          
          <div *ngIf="!filters.date" class="asset-placeholder">
            <p>Select a date to view distress data</p>
          </div>
          
          <div *ngIf="filters.date && rawData.length === 0" class="asset-placeholder">
            <div class="loading-spinner"></div>
            <p>Loading distress data...</p>
          </div>
          
          <div *ngIf="filters.date" class="distress-sections">
            <!-- Point Distress Section -->
            <div class="distress-grid">
              <div 
                *ngFor="let distress of pointDistresses" 
                class="asset-card"
                [class.selected]="selectedDistressType === distress.name"
                [style.border-left-color]="distress.color"
                (click)="onDistressCardClick(distress)">
                <div class="asset-info">
                  <div class="asset-name">{{ distress.name }}</div>
                  <div class="asset-count">{{ distress.count }}</div>
                </div>
              </div>
            </div>
            
            <!-- Cracks & Rutting Section -->
            <div class="section-header">Cracks & Rutting (Meter)</div>
            <div class="distress-grid">
              <div 
                *ngFor="let distress of cracksAndRutting" 
                class="asset-card"
                [class.selected]="selectedDistressType === distress.name"
                [style.border-left-color]="distress.color"
                (click)="onDistressCardClick(distress)">
                <div class="asset-info">
                  <div class="asset-name">{{ distress.name }}</div>
                  <div class="asset-count">{{ distress.count }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chainage Comparison Chart Modal -->
  <div *ngIf="isChainageComparisonModalOpen" class="modal-backdrop comparison-modal-backdrop" (click)="closeChainageComparisonModal()">
    <div class="modal-content comparison-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i class="fas fa-chart-line"></i>
          Predicted Distress Distribution Along Chainage
        </h3>
        <button class="modal-close-btn" (click)="closeChainageComparisonModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="modal-body comparison-modal-body">
        <!-- Distress Selection Chips -->
        <div class="asset-selection-section">
          <div class="asset-selection-header">
            <h4>Select Distress Types to Compare (Max 5):</h4>
            <span class="selection-count">{{ selectedDistressesForComparison.length }}/5 Selected</span>
          </div>
          <div class="asset-chips-container">
            <button
              *ngFor="let distress of availableDistressesForComparison"
              class="asset-chip"
              [class.selected]="isDistressSelectedForComparison(distress)"
              [style.border-color]="getDistressColorForChip(distress)"
              [style.background-color]="getDistressChipBackgroundColor(distress)"
              (click)="toggleDistressForComparison(distress)"
            >
              <span class="chip-color-indicator" [style.background-color]="getDistressColorForChip(distress)"></span>
              {{ distress }}
              <i *ngIf="isDistressSelectedForComparison(distress)" class="fas fa-check"></i>
            </button>
          </div>
        </div>

        <!-- Comparison Chart -->
        <div class="comparison-chart-container">
          <div *ngIf="selectedDistressesForComparison.length === 0" class="no-assets-selected">
            <p>Please select at least one distress type to view the comparison chart</p>
          </div>
          <div 
            *ngIf="selectedDistressesForComparison.length > 0 && chainageComparisonChartOptions && chainageComparisonChartOptions.series" 
            echarts 
            [options]="chainageComparisonChartOptions" 
            class="comparison-echarts-chart"
            style="width: 100%; height: 500px; background: rgba(0,0,0,0.2);"
          ></div>
          <div *ngIf="selectedDistressesForComparison.length > 0 && (!chainageComparisonChartOptions || !chainageComparisonChartOptions.series)" class="loading-chart">
            <div class="loading-spinner"></div>
            <p>Generating chart...</p>
          </div>
        </div>

        <!-- Chart Legend Info -->
        <!-- <div *ngIf="selectedDistressesForComparison.length > 0" class="chart-info">
          <p>
            <i class="fas fa-info-circle"></i>
            Showing distribution from <strong>{{ getChainageMin().toFixed(2) }} KM</strong> to 
            <strong>{{ getChainageMax().toFixed(2) }} KM</strong>
          </p>
        </div> -->
      </div>
    </div>
  </div>

  <!-- Month-wise Comparison Chart Modal -->
  <div *ngIf="isMonthComparisonModalOpen" class="modal-backdrop comparison-modal-backdrop" (click)="closeMonthComparisonModal()">
    <div class="modal-content comparison-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i class="fas fa-calendar-alt"></i>
          <span *ngIf="selectedDistressesForMonthComparison.length === 1">{{ selectedDistressesForMonthComparison[0] }} - Month-wise Comparison</span>
          <span *ngIf="selectedDistressesForMonthComparison.length !== 1">Distress Distribution - Month-wise Comparison</span>
        </h3>
        <button class="modal-close-btn" (click)="closeMonthComparisonModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>
      
      <div class="modal-body comparison-modal-body">
        <div *ngIf="showDistressSelectionInModal" class="asset-selection-section">
          <div class="asset-selection-header">
            <h4>Select Distress Types to Compare (Max 5):</h4>
            <span class="selection-count">{{ selectedDistressesForMonthComparison.length }}/5 Selected</span>
          </div>
          <div class="asset-chips-container">
            <button
              *ngFor="let distress of distressSummary"
              class="asset-chip"
              [class.selected]="isDistressSelectedForMonthComparison(distress.name)"
              [style.border-color]="getDistressColor(distress.name)"
              [style.background-color]="getDistressChipBackgroundColorForMonth(distress.name)"
              (click)="toggleDistressForMonthComparison(distress.name)"
            >
              <span class="chip-color-indicator" [style.background-color]="getDistressColor(distress.name)"></span>
              {{ distress.name }}
              <i *ngIf="isDistressSelectedForMonthComparison(distress.name)" class="fas fa-check"></i>
            </button>
          </div>
        </div>

        <div class="comparison-chart-container">
          <div *ngIf="selectedDistressesForMonthComparison.length === 0" class="no-assets-selected">
            <p>Please select at least one distress type to view the month-wise comparison chart</p>
          </div>
          <div *ngIf="isLoadingMonthChart" class="loading-chart">
            <div class="loading-spinner"></div>
            <p>Loading month-wise data...</p>
          </div>
          <div
            *ngIf="!isLoadingMonthChart && selectedDistressesForMonthComparison.length > 0 && monthComparisonChartOptions && monthComparisonChartOptions.series"
            echarts
            [options]="monthComparisonChartOptions"
            class="comparison-echarts-chart"
            style="width: 100%; height: 500px;"
          ></div>
        </div>
      </div>
    </div>
  </div>
</div>