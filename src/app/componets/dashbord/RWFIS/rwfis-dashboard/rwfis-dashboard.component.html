<div class="dashboard-container">
  <!-- Main Content Area -->
  <!-- Dashboard Content (always show) -->
  <div>
    <!-- Filter Containers -->
    <div class="filters-container">
      <!-- Main Filters Container (80% width) -->
      <div class="main-filters-container">
        <div class="filter-row-main">
          <div class="filter-group">
            <label>Project Name:</label>
            <select
              [value]="filters.projectName"
              (change)="onProjectChange($event)"
              class="filter-select"
            >
              <option
                *ngFor="let project of availableProjects"
                [value]="project"
              >
                {{ project }}
              </option>
            </select>
          </div>

          <div class="filter-group">
            <label>Date:</label>
            <select
              [value]="filters.date"
              (change)="onDateChange($event)"
              class="filter-select"
            >
              <option *ngFor="let date of availableDates" [value]="date">
                {{ date }}
              </option>
            </select>
          </div>

          <div class="filter-group">
            <label>Direction:</label>
            <select
              [value]="filters.direction"
              (change)="onDirectionChange($event)"
              class="filter-select"
            >
              <option
                *ngFor="let direction of availableDirections"
                [value]="direction"
              >
                {{ direction }}
              </option>
            </select>
          </div>

          <div class="filter-group">
            <label>Pavement Type:</label>
            <select
              [value]="filters.pavementType"
              (change)="onPavementTypeChange($event)"
              class="filter-select"
            >
              <option value="All">All</option>
              <option
                *ngFor="let type of availablePavementTypes"
                [value]="type"
              >
                {{ type }}
              </option>
            </select>
          </div>

          <div class="filter-group">
            <label>Lane:</label>
            <select
              [value]="filters.lane"
              (change)="onLaneChange($event)"
              class="filter-select"
            >
              <option value="All">All</option>
              <option *ngFor="let lane of availableLanes" [value]="lane">
                {{ lane }}
              </option>
            </select>
          </div>

          <div class="filter-group chainage-range-group">
            <label class="chainage-range-label"
              >Chainage: {{ filters.chainageRange.min.toFixed(3) }} -
              {{ filters.chainageRange.max.toFixed(3) }}</label
            >
            <div class="chainage-inputs">
              <input
                type="number"
                [min]="getChainageMin()"
                [max]="filters.chainageRange.max"
                [value]="filters.chainageRange.min"
                (input)="onChainageMinChange($event)"
                class="chainage-input"
                step="0.001"
              />
              <input
                type="number"
                [min]="filters.chainageRange.min"
                [max]="getChainageMax()"
                [value]="filters.chainageRange.max"
                (input)="onChainageMaxChange($event)"
                class="chainage-input"
                step="0.001"
              />
            </div>
            <div class="chainage-slider-container">
              <input
                type="range"
                [min]="getChainageMin()"
                [max]="getChainageMax()"
                [value]="filters.chainageRange.min"
                (input)="onChainageMinSliderChange($event)"
                class="chainage-slider"
              />
              <input
                type="range"
                [min]="getChainageMin()"
                [max]="getChainageMax()"
                [value]="filters.chainageRange.max"
                (input)="onChainageMaxSliderChange($event)"
                class="chainage-slider"
              />
            </div>
          </div>

          <!-- <div class="filter-group">
            <label>Distress Type:</label>
            <select [value]="filters.distressType" (change)="onDistressTypeChange($event)" class="filter-select">
              <option value="All">All</option>
              <option *ngFor="let type of availableDistressTypes" [value]="type">{{ type }}</option>
            </select>
          </div> -->
        </div>
      </div>
    </div>

    <!-- Mobile Sidebar Toggle -->
    <!-- <button class="sidebar-toggle" (click)="toggleSidebar()">
      <span class="hamburger-icon">â˜°</span>
    </button> -->

    <!-- Mobile Sidebar Overlay -->
    <div
      class="sidebar-overlay"
      [class.active]="isSidebarOpen"
      (click)="toggleSidebar()"
    ></div>

    <!-- Main Dashboard Container -->
    <div class="main-dashboard-container">
      <!-- Left Panel (70% width) -->
      <div class="left-panel">
        <!-- Chainage Wise Distress Chart -->
        <!-- <div class="chart-container">
          <div class="chart-wrapper">
            <div echarts [options]="chartOptions" class="echarts-chart"></div>
          </div>
        </div> -->

        <!-- Actual Distress Map -->
        <div class="map-container">
          <div class="chart-header">
            <h3>Location wise RWFIS Distribution</h3>
          </div>
          <div class="map-wrapper">
            <div *ngIf="!filters.date" class="map-placeholder">
              <p>Select a date to view map data</p>
            </div>
            <div
              *ngIf="filters.date && rawData.length === 0"
              class="map-placeholder"
            >
              <div class="loading-spinner"></div>
              <p>Loading map data...</p>
            </div>
            <div *ngIf="filters.date" id="mapContainer" class="map"></div>
          </div>
        </div>
      </div>

      <!-- Right Panel (30% width) -->
      <div class="right-panel" [class.sidebar-open]="isSidebarOpen">
        <div class="asset-summary">
          <div class="asset-summary-header">
            <h3>RWFIS Information Summary</h3>
            <button 
              class="month-comparison-toggle"
              [class.active]="isMonthComparisonMode"
              [class.loading]="isPreloadingMonthData"
              (click)="toggleMonthComparisonMode()"
              title="{{ isMonthComparisonMode ? 'Click to disable month comparison mode' : 'Click to enable month comparison mode' }}"
            >
              <i *ngIf="!isPreloadingMonthData" class="fas fa-calendar-alt"></i>
              <i *ngIf="isPreloadingMonthData" class="fas fa-spinner fa-spin"></i>
              <span class="toggle-label">{{ isMonthComparisonMode ? 'ON' : 'OFF' }}</span>
            </button>
          </div>
          <div class="asset-grid mobile-grid">
            <div *ngIf="!filters.date" class="asset-placeholder">
              <p>Select a date to view pavement information</p>
            </div>
            <div
              *ngIf="filters.date && rawData.length === 0"
              class="asset-placeholder"
            >
              <div class="loading-spinner"></div>
              <p>Loading pavement information...</p>
            </div>
            <div 
              *ngFor="let info of rwfisInfoData" 
              class="asset-card"
              [class.selected]="selectedInfoCard === info.title"
              (click)="onInfoCardClick(info)"
              style="cursor: pointer;"
            >
              <div class="asset-info">
                <div class="asset-name">{{ info.title }}</div>
                <div class="asset-count">
                  {{ info.value }}{{ info.unit ? " " + info.unit : "" }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Month Comparison Modal -->
<div *ngIf="isMonthComparisonModalOpen" class="comparison-modal-backdrop" (click)="closeMonthComparisonModal()">
  <div class="comparison-modal-content" (click)="$event.stopPropagation()">
    <div class="comparison-modal-header">
      <h2>
        {{ selectedMetricsForMonthComparison.length === 1 ? selectedMetricsForMonthComparison[0] : 'RWFIS Metrics' }} - Month-wise Comparison
      </h2>
      <button class="close-btn" (click)="closeMonthComparisonModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="comparison-modal-body">
      <!-- Metric Selection -->
      <div class="asset-selection-section" *ngIf="showMetricSelectionInModal">
        <h3>Select Metrics to Compare (Max 5)</h3>
        <div class="asset-chips-container">
          <div
            *ngFor="let metric of ['Altitude(M)', 'Offset From Center line (M)']"
            class="asset-chip"
            [class.selected]="isMetricSelectedForMonthComparison(metric)"
            [style.border-color]="getMetricColor(metric)"
            [style.background-color]="getMetricChipBackgroundColorForMonth(metric)"
            (click)="toggleMetricForMonthComparison(metric)"
          >
            <span class="chip-color-indicator" [style.background-color]="getMetricColor(metric)"></span>
            <span class="chip-label">{{ metric }}</span>
            <i class="bi bi-check-circle-fill chip-checkmark" *ngIf="isMetricSelectedForMonthComparison(metric)"></i>
          </div>
        </div>
      </div>

      <!-- Chart Container -->
      <div class="comparison-chart-container">
        <div *ngIf="isLoadingMonthChart" class="chart-loading">
          <div class="loading-spinner"></div>
          <p>Loading month-wise data...</p>
        </div>

        <div *ngIf="!isLoadingMonthChart && selectedMetricsForMonthComparison.length === 0" class="chart-empty">
          <i class="bi bi-bar-chart-line"></i>
          <p>Please select at least one metric to compare</p>
        </div>

        <div
          *ngIf="!isLoadingMonthChart && selectedMetricsForMonthComparison.length > 0"
          class="comparison-echarts-chart"
          echarts
          [options]="monthComparisonChartOptions"
          [loading]="isLoadingMonthChart"
        ></div>
      </div>

      <!-- Info Banner -->
      <div class="chart-info" *ngIf="!isLoadingMonthChart && selectedMetricsForMonthComparison.length > 0">
        <i class="bi bi-info-circle"></i>
        <span>Showing {{ selectedMetricsForMonthComparison.length }} metric(s) across {{ availableMonthsForComparison.length }} month(s)</span>
      </div>
    </div>
  </div>
</div>
